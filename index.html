<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BookerPilot â€” NYC Return Pickup</title>
<meta name="description" content="We pick up your return & drop it at USPS/UPS/FedEx/Amazon Hub. Flat $6.99 + optional $2 insurance. NYC metro only."/>
<link rel="icon" href="data:;base64,iVBORw0KGgo="/>
<!-- Tailwind via CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Chart.js for reviews chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  :root { --brand:#0b74de }
  .btn { @apply inline-flex items-center justify-center rounded-md bg-[color:var(--brand)] text-white px-4 py-2 font-medium hover:opacity-90 transition; }
  .card { @apply bg-white border border-gray-200 rounded-xl shadow-sm; }
  .container-narrow { @apply max-w-4xl mx-auto px-4; }
  .container-wide { @apply max-w-6xl mx-auto px-4; }
  .link { @apply text-[color:var(--brand)] hover:underline; }
</style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header -->
  <header class="border-b bg-white">
    <div class="container-wide py-3 flex items-center justify-between">
      <a href="#/" class="text-2xl font-semibold" style="color:var(--brand)">BookerPilot</a>
      <nav class="flex gap-5 text-sm">
        <a class="link" href="#/book">Book Pickup</a>
        <a class="link" href="#/pricing">Pricing</a>
        <a class="link" href="#/reviews">Reviews</a>
        <a class="link" href="#/faq">FAQ</a>
        <a class="link" href="#/service-area">Service Area</a>
        <a class="link" href="#/legal">Legal</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main id="app" class="container-wide py-6"></main>

  <!-- Footer -->
  <footer class="border-t bg-white mt-10">
    <div class="container-wide py-6 text-sm text-gray-600">
      <p>Â© <span id="year"></span> BookerPilot â€” NYC returns pickup. Not affiliated with retailers.</p>
      <p class="mt-1">Flat $6.99 per pickup (+$2 optional insurance). Coverage: NYC metro only.</p>
    </div>
  </footer>

<script>
/* ------------------------------
   CONFIG / CONSTANTS
--------------------------------*/
const BASE_PRICE = 6.99;
const INSURANCE_PRICE = 2.00;
const CITY_LABEL = "NYC Metro";
const NYC_ZIPS = new Set([
  // Manhattan
  "10001","10002","10003","10004","10005","10006","10007","10009","10010","10011","10012","10013","10014","10016","10017","10018","10019","10020","10021","10022","10023","10024","10025","10026","10027","10028","10029","10030","10031","10032","10033","10034","10035","10036","10037","10038","10039","10040",
  // Brooklyn (subset)
  "11201","11203","11204","11205","11206","11207","11208","11209","11210","11211","11212","11213","11214","11215","11216","11217","11218","11219","11220","11221","11222","11223","11224","11225","11226","11228","11229","11230","11231","11232","11233","11234","11235","11236","11237","11238",
  // Queens (subset)
  "11101","11102","11103","11104","11105","11106","11354","11355","11356","11357","11358","11360","11361","11362","11363","11364","11365","11366","11367","11368","11369","11370","11372","11373","11374","11375","11377","11378","11379","11385",
  // Bronx
  "10451","10452","10453","10454","10455","10456","10457","10458","10459","10460","10461","10462","10463","10464","10465","10466","10467","10468","10469","10470","10471","10472","10473","10474","10475",
  // Staten Island
  "10301","10302","10303","10304","10305","10306","10307","10308","10309","10310","10312","10314"
]);
/* Demo order store (in-memory for SPA) */
const ORDERS = new Map(); // id -> order object

/* ------------------------------
   UTIL
--------------------------------*/
const $ = (sel, root=document) => root.querySelector(sel);
const h = (html) => { const d=document.createElement('div'); d.innerHTML=html; return d.firstElementChild; };
function fmtMoney(n){ return `$${n.toFixed(2)}`; }
function uid(){ return Math.random().toString(36).slice(2,10); }
function calcTotal(items, insurance, weightBand){
  let add = 0;
  if(items>1) add += (items-1)*2;       // $2 per extra box
  if(weightBand==="15-25") add += 2;
  if(weightBand==="25+") add += 4;
  if(insurance) add += INSURANCE_PRICE;
  return +(BASE_PRICE + add);
}

/* ------------------------------
   DEMO REVIEWS (SAMPLE ONLY)
   ~70% â˜…â˜…â˜…â˜…â˜…, some 4/3/2, and exactly 20 â˜…
--------------------------------*/
function generateDemoReviews(){
  const total = 465, ones = 20, fives = Math.floor(total * 0.70);
  let left = total - fives - ones;
  const fours = Math.floor(left * 0.60); left -= fours;
  const threes = Math.floor(left * 0.60);
  const twos = total - fives - fours - threes - ones;
  const boroughs = ["Manhattan","Brooklyn","Queens","Bronx","Staten Island"];
  const names = ["Jordan R.","Sam P.","Nadia K.","Luis A.","Priya S.","Mike D.","Elena T.","Chris W.","Aisha F.","Tommy L.","Ray H.","Shannon C.","Leo M.","Irene V.","Zach T."];
  const texts = {
    5:[
      "SAMPLE: Same-day pickup, zero hassle. Loved the proof photo.",
      "SAMPLE: Cheapest way to return Amazon Iâ€™ve used in NYC.",
      "SAMPLE: Courteous driver and on-time. Will use again.",
      "SAMPLE: Label upload + pickup window = perfect.",
      "SAMPLE: Apartment friendlyâ€”no lobby headaches.",
      "SAMPLE: Clear pricing and super fast.",
      "SAMPLE: So easy compared to waiting at UPS!"
    ],
    4:[
      "SAMPLE: Smooth overall, pickup 10 mins late.",
      "SAMPLE: Great price, more evening slots please.",
      "SAMPLE: Worked as promised; tracking helped."
    ],
    3:[
      "SAMPLE: Did the job. More morning windows would help.",
      "SAMPLE: Ok; driver called twice to find the buzzer."
    ],
    2:[
      "SAMPLE: Pickup rescheduled due to weather, still completed.",
      "SAMPLE: Label upload failed once; second try worked."
    ],
    1:[
      "SAMPLE: Missed my slot; rebook wasnâ€™t immediate.",
      "SAMPLE: Drop-off proof took hours to show."
    ]
  };
  const out=[];
  const pushMany=(count, rating)=>{
    for(let i=0;i<count;i++){
      out.push({
        id: uid(),
        name: names[Math.floor(Math.random()*names.length)],
        rating,
        text: texts[rating][Math.floor(Math.random()*texts[rating].length)],
        borough: boroughs[Math.floor(Math.random()*boroughs.length)],
        verified: Math.random()>0.25,
        createdAt: Date.now()-Math.floor(Math.random()*60*24*60*60*1000) // within ~60 days
      });
    }
  };
  pushMany(fives,5); pushMany(fours,4); pushMany(threes,3); pushMany(twos,2); pushMany(ones,1);
  // shuffle
  out.sort(()=>Math.random()-0.5);
  return out;
}
const DEMO_REVIEWS = generateDemoReviews();

/* ------------------------------
   VIEWS
--------------------------------*/
function StarRow(rating){
  const full = 'â˜…'.repeat(rating), empty='â˜†'.repeat(5-rating);
  return `<span class="text-amber-500">${full}</span><span class="text-gray-300">${empty}</span>`;
}

function HeaderKPI(){
  return `
  <section class="grid md:grid-cols-3 gap-4 mt-6">
    <div class="card p-5">
      <div class="text-3xl font-bold">NYC-Only</div>
      <div class="text-gray-600 mt-1 text-sm">We serve the five boroughs â€” fast, local routes.</div>
    </div>
    <div class="card p-5">
      <div class="text-3xl font-bold">Flat ${fmtMoney(BASE_PRICE)}</div>
      <div class="text-gray-600 mt-1 text-sm">Add ${fmtMoney(INSURANCE_PRICE)} insurance (optional) up to $200 coverage.</div>
    </div>
    <div class="card p-5">
      <div class="text-3xl font-bold">Proof & Tracking</div>
      <div class="text-gray-600 mt-1 text-sm">Photo + timestamp when your return is dropped off.</div>
    </div>
  </section>`;
}

function ViewHome(){
  return `
  <div class="grid gap-6">
    <section class="card p-6">
      <h1 class="text-3xl font-semibold">Return pickup in NYC â€” <span style="color:var(--brand)">${fmtMoney(BASE_PRICE)}</span></h1>
      <p class="text-gray-600 mt-2">Upload your prepaid label, pick a 2-hour window, we collect and drop at USPS/UPS/FedEx/Amazon Hub. Optional ${fmtMoney(INSURANCE_PRICE)} insurance (up to $200).</p>
      <div class="mt-5">
        <form id="zipForm" class="flex flex-col sm:flex-row gap-3 items-start sm:items-center">
          <input id="zipInput" class="border rounded-md px-3 py-2 w-48" placeholder="Enter NYC ZIP"/>
          <button class="btn">Check & Book</button>
          <span id="zipErr" class="text-red-600 text-sm"></span>
        </form>
      </div>
      <ul class="mt-6 grid md:grid-cols-3 gap-3 text-sm">
        <li class="card p-4">âœ… Same-day & next-day windows</li>
        <li class="card p-4">ðŸ“· Proof photo & drop-off timestamp</li>
        <li class="card p-4">ðŸ—½ ${CITY_LABEL} coverage only</li>
      </ul>
    </section>
    ${HeaderKPI()}
    <section class="card p-6">
      <h2 class="text-2xl font-semibold">How it works</h2>
      <ol class="list-decimal ml-6 mt-3 space-y-2 text-gray-700">
        <li>Enter your ZIP to confirm NYC service.</li>
        <li>Upload your prepaid return label & select a pickup window.</li>
        <li>Pay ${fmtMoney(BASE_PRICE)} (add ${fmtMoney(INSURANCE_PRICE)} insurance if you want). We pick it up and send proof when dropped.</li>
      </ol>
      <a href="#/book" class="btn mt-5">Book a pickup</a>
    </section>
  </div>`;
}

function ViewBook(){
  return `
  <div class="card p-6">
    <h1 class="text-2xl font-semibold">Book a pickup</h1>
    <p class="text-sm text-gray-600 mt-1">${CITY_LABEL} only. Prepaid labels required. Most items under 25 lb; see FAQ for limits.</p>
    <form id="bookForm" class="grid md:grid-cols-2 gap-4 mt-4">
      <div>
        <label class="block text-sm font-medium">Email</label>
        <input required name="email" type="email" class="border rounded-md px-3 py-2 w-full"/>
      </div>
      <div>
        <label class="block text-sm font-medium">Phone (optional)</label>
        <input name="phone" class="border rounded-md px-3 py-2 w-full"/>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium">Name (optional)</label>
        <input name="name" class="border rounded-md px-3 py-2 w-full"/>
      </div>

      <div class="md:col-span-2 grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium">Address</label>
          <input required name="address1" class="border rounded-md px-3 py-2 w-full"/>
        </div>
        <div>
          <label class="block text-sm font-medium">Apt / Suite (optional)</label>
          <input name="address2" class="border rounded-md px-3 py-2 w-full"/>
        </div>
        <div>
          <label class="block text-sm font-medium">City</label>
          <input required name="city" value="New York" class="border rounded-md px-3 py-2 w-full"/>
        </div>
        <div>
          <label class="block text-sm font-medium">State</label>
          <input required name="state" value="NY" class="border rounded-md px-3 py-2 w-full"/>
        </div>
        <div>
          <label class="block text-sm font-medium">ZIP (NYC only)</label>
          <input required name="zip" class="border rounded-md px-3 py-2 w-full"/>
          <p id="zipWarn" class="text-xs text-red-600 mt-1"></p>
        </div>
        <div>
          <label class="block text-sm font-medium">Pickup Date</label>
          <input required name="date" type="date" class="border rounded-md px-3 py-2 w-full"/>
        </div>
        <div>
          <label class="block text-sm font-medium">Time Window</label>
          <select name="slot" class="border rounded-md px-3 py-2 w-full">
            <option value="10:00-12:00">10:00â€“12:00</option>
            <option value="12:00-14:00">12:00â€“14:00</option>
            <option value="16:00-18:00">16:00â€“18:00</option>
            <option value="18:00-20:00">18:00â€“20:00</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium">Carrier</label>
          <select name="carrier" class="border rounded-md px-3 py-2 w-full">
            <option>USPS</option><option>UPS</option><option>FedEx</option><option>AmazonHub</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium">Packages</label>
          <input required name="itemsCount" type="number" min="1" max="6" value="1" class="border rounded-md px-3 py-2 w-full"/>
        </div>
        <div>
          <label class="block text-sm font-medium">Weight</label>
          <select name="weightBand" class="border rounded-md px-3 py-2 w-full">
            <option value="<=15">â‰¤ 15 lb</option>
            <option value="15-25">15â€“25 lb (+$2)</option>
            <option value="25+">> 25 lb (+$4)</option>
          </select>
        </div>
      </div>

      <div class="md:col-span-2">
        <label class="block text-sm font-medium">Building / pickup notes (optional)</label>
        <textarea name="notes" class="border rounded-md px-3 py-2 w-full" rows="3" placeholder="Buzzer code, leave with doorman, etc."></textarea>
      </div>

      <div class="md:col-span-2">
        <label class="block text-sm font-medium">Upload prepaid label (PDF / image)</label>
        <input id="labelFile" type="file" accept=".pdf,.png,.jpg,.jpeg" class="border rounded-md px-3 py-2 w-full"/>
        <p class="text-xs text-gray-500 mt-1">If your retailer provides a QR code (no printer), just upload a screenshot of the QR.</p>
      </div>

      <div class="md:col-span-2 flex items-center gap-2">
        <input id="insurance" type="checkbox"/>
        <label for="insurance" class="text-sm">Add insurance for ${fmtMoney(INSURANCE_PRICE)} (coverage up to $200 while in our possession)</label>
      </div>

      <div class="md:col-span-2 flex items-center justify-between bg-gray-50 border rounded-lg px-4 py-3">
        <div class="text-sm">
          <div>Base: <strong>${fmtMoney(BASE_PRICE)}</strong></div>
          <div class="text-gray-600">Extras: +$2 per extra box; +$2 (15â€“25 lb), +$4 (>25 lb); +${fmtMoney(INSURANCE_PRICE)} optional insurance.</div>
        </div>
        <div class="text-right">
          <div class="text-xs text-gray-500">Estimated total</div>
          <div id="estTotal" class="text-xl font-semibold">${fmtMoney(BASE_PRICE)}</div>
        </div>
      </div>

      <div class="md:col-span-2 flex gap-3">
        <button class="btn" type="submit">Pay & Book (test)</button>
        <a class="link text-sm" href="#/faq">Whatâ€™s covered?</a>
      </div>
      <p id="bookErr" class="text-red-600 text-sm md:col-span-2"></p>
    </form>
  </div>`;
}

function ViewTrack(id){
  const o = ORDERS.get(id);
  if(!o){
    return `
    <div class="card p-6">
      <h1 class="text-2xl font-semibold">Track your pickup</h1>
      <p class="mt-2 text-sm text-gray-600">We couldnâ€™t find that order. Double-check your tracking link.</p>
    </div>`;
  }
  return `
  <div class="card p-6">
    <h1 class="text-2xl font-semibold">Order #${o.id}</h1>
    <p class="text-sm text-gray-600 mt-1">${o.email} â€” ${o.address1}, ${o.city} ${o.state} ${o.zip}</p>
    <div class="grid md:grid-cols-3 gap-4 mt-4">
      <div class="card p-4">
        <div class="text-xs text-gray-500">Status</div>
        <div class="text-lg font-semibold">${o.status}</div>
      </div>
      <div class="card p-4">
        <div class="text-xs text-gray-500">Pickup window</div>
        <div class="text-lg font-semibold">${o.date} ${o.slot}</div>
      </div>
      <div class="card p-4">
        <div class="text-xs text-gray-500">Total paid</div>
        <div class="text-lg font-semibold">${fmtMoney(o.total)}</div>
      </div>
    </div>
    <div class="mt-4 text-sm">
      <div>Carrier: <strong>${o.carrier}</strong></div>
      <div>Packages: <strong>${o.itemsCount}</strong>, Weight: <strong>${o.weightBand}</strong>, Insurance: <strong>${o.insurance ? 'Yes' : 'No'}</strong></div>
      <div class="mt-2 text-gray-600">Youâ€™ll receive a photo + timestamp once we drop off your return.</div>
    </div>
  </div>`;
}

function ViewPricing(){
  return `
  <div class="grid gap-6">
    <section class="card p-6">
      <h1 class="text-2xl font-semibold">Pricing</h1>
      <ul class="mt-3 text-gray-700 space-y-2">
        <li>Base pickup (NYC only): <strong>${fmtMoney(BASE_PRICE)}</strong></li>
        <li>Optional insurance: <strong>${fmtMoney(INSURANCE_PRICE)}</strong> (coverage up to $200 while in our possession)</li>
        <li>Extra box: <strong>$2</strong> each (same address & window)</li>
        <li>Weight adders: <strong>$2</strong> (15â€“25 lb), <strong>$4</strong> (>25 lb)</li>
      </ul>
      <p class="text-sm text-gray-600 mt-3">Prepaid labels only. Weâ€™re a courier, not the retailer. Not affiliated with any carrier.</p>
    </section>
  </div>`;
}

function ViewFAQ(){
  return `
  <div class="grid gap-6">
    <section class="card p-6">
      <h1 class="text-2xl font-semibold">FAQ</h1>
      <div class="mt-3 space-y-4 text-gray-800">
        <div>
          <h3 class="font-medium">Do you serve only NYC?</h3>
          <p class="text-sm text-gray-700">Yes â€” we currently cover the NYC metro (five boroughs). Enter your ZIP on the home page to confirm coverage.</p>
        </div>
        <div>
          <h3 class="font-medium">Do I need a printer?</h3>
          <p class="text-sm text-gray-700">If your retailer supports QR codes, upload a screenshot. Otherwise upload a PDF/image of your label and attach it to your package.</p>
        </div>
        <div>
          <h3 class="font-medium">Whatâ€™s covered by insurance?</h3>
          <p class="text-sm text-gray-700">Optional ${fmtMoney(INSURANCE_PRICE)} covers up to $200 if your package is lost or damaged while in our possession (from pickup until accepted by the carrier). You must submit a claim within 7 days with proof of value.</p>
        </div>
        <div>
          <h3 class="font-medium">Whatâ€™s not allowed?</h3>
          <p class="text-sm text-gray-700">Hazmat/aerosols/batteries/liquids per carrier rules; improperly sealed boxes; items over 50 lb; cash or perishable goods.</p>
        </div>
        <div>
          <h3 class="font-medium">Can I cancel?</h3>
          <p class="text-sm text-gray-700">Free up to 2 hours before your slot. Inside 2 hours or missed pickup: $3 fee.</p>
        </div>
      </div>
    </section>
  </div>`;
}

function ViewServiceArea(){
  return `
  <div class="grid gap-6">
    <section class="card p-6">
      <h1 class="text-2xl font-semibold">Service Area â€” NYC Metro Only</h1>
      <p class="text-sm text-gray-700 mt-1">We cover the five boroughs: Manhattan, Brooklyn, Queens, Bronx, Staten Island.</p>
      <p class="text-sm text-gray-700 mt-2">Enter your ZIP on the home page to confirm. Weâ€™re expanding coverage as we grow.</p>
    </section>
  </div>`;
}

function ViewLegal(){
  return `
  <div class="grid gap-6">
    <section class="card p-6">
      <h1 class="text-2xl font-semibold">Legal</h1>
      <h2 class="mt-4 font-medium">Terms of Service (summary)</h2>
      <ul class="list-disc ml-6 mt-2 text-sm text-gray-700 space-y-1">
        <li>We are a courier service for prepaid returns. Weâ€™re not affiliated with any retailer or carrier.</li>
        <li>Liability: from pickup until accepted by the carrier. Optional insurance (${fmtMoney(INSURANCE_PRICE)}) covers up to $200; otherwise liability is limited.</li>
        <li>Prohibited items: hazmat, liquids, perishable goods, cash, items over 50 lb, or not compliant with carrier policies.</li>
        <li>Missed pickup: $3; free cancellation up to 2 hours before your slot.</li>
      </ul>
      <h2 class="mt-6 font-medium">Privacy (summary)</h2>
      <ul class="list-disc ml-6 mt-2 text-sm text-gray-700 space-y-1">
        <li>We collect contact info and address solely to complete your pickup.</li>
        <li>Label images may contain personal info; theyâ€™re stored securely and auto-purged on a schedule.</li>
        <li>We do not sell your data.</li>
      </ul>
    </section>
  </div>`;
}

function ViewReviews(){
  // compute distribution
  const counts = {5:0,4:0,3:0,2:0,1:0};
  DEMO_REVIEWS.forEach(r=>counts[r.rating]++);
  const total = DEMO_REVIEWS.length;
  const pct = k => Math.round((counts[k]/total)*100);

  // top highlights (pick a handful)
  const highlights = DEMO_REVIEWS
    .filter(r=>r.rating>=4)
    .slice(0,6);

  // grid items
  const grid = DEMO_REVIEWS.slice(0,24).map(r=>`
    <div class="border rounded-lg p-3">
      <div class="flex items-center justify-between">
        <div class="font-medium">${r.name} <span class="text-xs text-gray-500">(${r.borough})</span></div>
        <div class="text-sm">${StarRow(r.rating)}</div>
      </div>
      <p class="text-sm text-gray-700 mt-2">${r.text}</p>
      <div class="text-[11px] text-orange-600 mt-1">SAMPLE review â€” replace with real customer reviews</div>
      <div class="text-xs text-gray-500 mt-1">${new Date(r.createdAt).toLocaleDateString()}</div>
    </div>
  `).join("");

  return `
  <div class="grid gap-6">
    <section class="card p-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
          <h1 class="text-2xl font-semibold">Customer Reviews</h1>
          <div class="text-sm text-gray-600">${total} total reviews (DEMO dataset)</div>
        </div>
        <div class="text-right">
          <div class="text-sm">Rating distribution</div>
          <canvas id="starsChart" width="360" height="160"></canvas>
        </div>
      </div>
      <div class="mt-4">
        <div class="text-sm text-gray-700 mb-2">
          ~${pct(5)}% â˜…â˜…â˜…â˜…â˜…, ${pct(4)}% â˜…â˜…â˜…â˜…, ${pct(3)}% â˜…â˜…â˜…, ${pct(2)}% â˜…â˜…, ${pct(1)}% â˜…
          â€” includes exactly 20 one-star reviews to keep it realistic.
        </div>
        <div class="grid md:grid-cols-3 gap-3">${grid}</div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        NOTE: All reviews shown here are **SAMPLE / PLACEHOLDER** to demo the UI. Replace with real reviews before launch.
      </div>
    </section>
  </div>`;
}

/* ------------------------------
   SIMPLE ROUTER
--------------------------------*/
function render(){
  const app = document.getElementById('app');
  const hash = location.hash || "#/";
  const [_, route, param] = hash.split("/"); // e.g. #/track/abc
  let html = "";

  if(route==="" || route===undefined){ html = ViewHome(); }
  else if(route==="book"){ html = ViewBook(); }
  else if(route==="track"){ html = ViewTrack(param||""); }
  else if(route==="pricing"){ html = ViewPricing(); }
  else if(route==="faq"){ html = ViewFAQ(); }
  else if(route==="service-area"){ html = ViewServiceArea(); }
  else if(route==="legal"){ html = ViewLegal(); }
  else if(route==="reviews"){ html = ViewReviews(); }
  else { html = `<div class="card p-6"><h1 class="text-2xl font-semibold">Not found</h1></div>`; }
  app.innerHTML = html;

  // hydrate interactive pieces
  if(route==="" || route===undefined){
    const form = document.getElementById("zipForm");
    if(form){
      form.addEventListener("submit",(e)=>{
        e.preventDefault();
        const zip = document.getElementById("zipInput").value.trim();
        const err = document.getElementById("zipErr");
        if(!/^\d{5}$/.test(zip)){ err.textContent="Enter a 5-digit ZIP."; return; }
        if(!NYC_ZIPS.has(zip)){ err.textContent="Sorry â€” we currently cover the NYC metro only."; return; }
        location.hash = "#/book";
      });
    }
  }

  if(route==="book"){
    const form = document.getElementById("bookForm");
    const estEl = document.getElementById("estTotal");
    const zipWarn = document.getElementById("zipWarn");
    const insuranceEl = document.getElementById("insurance");
    const itemsEl = form.querySelector('[name="itemsCount"]');
    const weightEl = form.querySelector('[name="weightBand"]');
    const zipEl = form.querySelector('[name="zip"]');
    const errEl = document.getElementById("bookErr");

    function refreshTotal(){
      const items = Math.max(1, parseInt(itemsEl.value||"1",10));
      const insurance = insuranceEl.checked;
      const weightBand = weightEl.value;
      estEl.textContent = fmtMoney(calcTotal(items, insurance, weightBand));
    }
    [insuranceEl,itemsEl,weightEl].forEach(el=>el.addEventListener("change",refreshTotal));
    refreshTotal();

    zipEl.addEventListener("blur", ()=>{
      const z = zipEl.value.trim();
      if(!/^\d{5}$/.test(z)) { zipWarn.textContent="Enter a 5-digit ZIP."; return; }
      if(!NYC_ZIPS.has(z)) { zipWarn.textContent="Sorry â€” NYC metro only."; return; }
      zipWarn.textContent="";
    });

    form.addEventListener("submit",(e)=>{
      e.preventDefault();
      errEl.textContent="";
      const data = Object.fromEntries(new FormData(form).entries());
      // validate ZIP NYC
      const z = (data.zip||"").toString().trim();
      if(!/^\d{5}$/.test(z) || !NYC_ZIPS.has(z)){ errEl.textContent="Service is NYC-only. Please use a NYC ZIP."; return; }

      const items = Math.max(1, parseInt(data.itemsCount||"1",10));
      const insurance = document.getElementById("insurance").checked;
      const weightBand = data.weightBand || "<=15";
      const total = calcTotal(items, insurance, weightBand);
      // fake "checkout": store order and go to track
      const id = uid();
      ORDERS.set(id, {
        id,
        status: "scheduled",
        email: data.email,
        phone: data.phone||"",
        name: data.name||"",
        address1: data.address1,
        address2: data.address2||"",
        city: data.city||"New York",
        state: data.state||"NY",
        zip: z,
        date: data.date,
        slot: data.slot,
        carrier: data.carrier,
        itemsCount: items,
        weightBand,
        insurance,
        total
      });
      // Normally, redirect to Stripe here. For SPA demo, go directly to track page.
      alert("Demo: payment step is stubbed. Proceeding to tracking page.");
      location.hash = "#/track/"+id;
    });
  }

  if(route==="reviews"){
    // Draw chart
    const ctx = document.getElementById("starsChart");
    if(ctx){
      const counts = {5:0,4:0,3:0,2:0,1:0};
      DEMO_REVIEWS.forEach(r=>counts[r.rating]++);
      // Chart.js defaults (no custom colors set)
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['5â˜…','4â˜…','3â˜…','2â˜…','1â˜…'],
          datasets: [{ label: 'Count', data: [counts[5],counts[4],counts[3],counts[2],counts[1]] }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display:false }, title: { display:false } },
          scales: { y: { beginAtZero:true, ticks: { stepSize: 50 } } }
        }
      });
    }
  }
}

window.addEventListener("hashchange", render);
window.addEventListener("load", ()=>{
  document.getElementById("year").textContent = new Date().getFullYear();
  render();
});
</script>
</body>
</html>
